{% extends "base.html" %}

{% block title %}Caesar Cipher Dashboard{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row">
        <div class="col-md-6 offset-md-3">
            <div class="card">
                <div class="card-header">
                    <h2 class="text-center">Caesar Cipher</h2>
                </div>
                <div class="card-body">
                    <!-- Part 1: Input -->
                    <div class="mb-3">
                        <label for="message" class="form-label">Enter Text:</label>
                        <textarea class="form-control" id="message" rows="3"
                            placeholder="Type your message... ðŸ˜Š"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="key" class="form-label">Shift Value:</label>
                        <input type="number" class="form-control" id="key" value="3">
                        <div id="keyError" class="text-danger mt-2" style="display: none;">Please enter a valid shift
                            value.</div>
                    </div>
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <button class="btn btn-primary me-md-2" onclick="encryptMessage()">Encrypt</button>
                        <button class="btn btn-secondary" onclick="decryptMessage()">Decrypt</button>
                    </div>
                </div>
            </div>
            <div class="card mt-4">
                <div class="card-header">
                    <h2 class="text-center">Output Result</h2>
                </div>
                <div class="card-body">
                    <div id="output" class="alert alert-secondary" role="alert">Encrypted/Decrypted text will appear
                        here...</div>
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <button class="btn btn-success me-md-2" onclick="copyOutput()">Copy Output</button>
                        <button class="btn btn-warning" onclick="clearFields()">Clear Fields</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function caesarCipher(str, shift, encrypt = true) {
        if (!encrypt) shift = -shift; // Inverse the shift for decryption

        return Array.from(str).map(char => {
            const code = char.charCodeAt();
            if (code >= 32 && code <= 126) {
                return String.fromCharCode(((code - 32 + shift) % 95 + 95) % 95 + 32);
            } else {
                return char;
            }
        }).join('');
    }

    // Encrypt message
    function encryptMessage() {
        const message = document.getElementById('message').value;
        const key = parseInt(document.getElementById('key').value);
        const keyError = document.getElementById('keyError');
        if (!isNaN(key)) {
            keyError.style.display = 'none';
            const encryptedMessage = caesarCipher(message, key, true);
            document.getElementById('output').innerText = encryptedMessage;
        } else {
            keyError.style.display = 'block';
        }
    }

    // Decrypt message
    function decryptMessage() {
        const message = document.getElementById('message').value;
        const key = parseInt(document.getElementById('key').value);
        const keyError = document.getElementById('keyError');
        if (!isNaN(key)) {
            keyError.style.display = 'none';
            const decryptedMessage = caesarCipher(message, key, false);
            document.getElementById('output').innerText = decryptedMessage;
        } else {
            keyError.style.display = 'block';
        }
    }

    // Copy output text to clipboard
    function copyOutput() {
        const outputText = document.getElementById('output').innerText;
        if (outputText) {
            const tempInput = document.createElement('textarea');
            tempInput.value = outputText;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);
            alert("Output copied to clipboard!");
        } else {
            alert("No output to copy!");
        }
    }

    // Clear fields function
    function clearFields() {
        document.getElementById('message').value = '';
        document.getElementById('key').value = 3;
        document.getElementById('output').innerText = 'Encrypted/Decrypted text will appear here...';
        document.getElementById('keyError').style.display = 'none';
    }
</script>
{% endblock %}