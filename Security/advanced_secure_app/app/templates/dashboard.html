{% extends "base.html" %}

{% block title %}Caesar Cipher Dashboard{% endblock %}

{% block content %}
<div class="dashboard">
    <!-- Part 1: Input -->
    <div class="part">
        <h2>Input Text & Shift Value</h2>
        <label for="message">Enter Text:</label>
        <textarea id="message" placeholder="Type your message... ðŸ˜Š"></textarea>

        <label for="key">Shift Value:</label>
        <input type="number" id="key" value="3">

        <p id="keyError">Please enter a valid shift value.</p>

        <div class="buttons-container">
            <button onclick="encryptMessage()">Encrypt</button>
            <button onclick="decryptMessage()">Decrypt</button>
        </div>
    </div>

    <!-- Part 2: Output -->
    <div class="part">
        <h2>Output Result</h2>
        <div id="output" class="output">Encrypted/Decrypted text will appear here...</div>

        <div class="buttons-container">
            <button onclick="copyOutput()">Copy Output</button>
            <button onclick="clearFields()">Clear Fields</button>
        </div>
    </div>
</div>

<script>
    function caesarCipher(str, shift, encrypt = true) {
        if (!encrypt) shift = -shift; // Inverse the shift for decryption

        return Array.from(str).map(char => {
            const code = char.charCodeAt();
            if (code >= 32 && code <= 126) {
                return String.fromCharCode(((code - 32 + shift) % 95 + 95) % 95 + 32);
            } else {
                return char;
            }
        }).join('');
    }

    // Encrypt message
    function encryptMessage() {
        const message = document.getElementById('message').value;
        const key = parseInt(document.getElementById('key').value);
        const keyError = document.getElementById('keyError');
        if (!isNaN(key)) {
            keyError.style.display = 'none';
            const encryptedMessage = caesarCipher(message, key, true);
            document.getElementById('output').innerText = encryptedMessage;
        } else {
            keyError.style.display = 'block';
        }
    }

    // Decrypt message
    function decryptMessage() {
        const message = document.getElementById('message').value;
        const key = parseInt(document.getElementById('key').value);
        const keyError = document.getElementById('keyError');
        if (!isNaN(key)) {
            keyError.style.display = 'none';
            const decryptedMessage = caesarCipher(message, key, false);
            document.getElementById('output').innerText = decryptedMessage;
        } else {
            keyError.style.display = 'block';
        }
    }

    // Copy output text to clipboard
    function copyOutput() {
        const outputText = document.getElementById('output').innerText;
        if (outputText) {
            const tempInput = document.createElement('textarea');
            tempInput.value = outputText;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);
            alert("Output copied to clipboard!");
        } else {
            alert("No output to copy!");
        }
    }

    // Clear fields function
    function clearFields() {
        document.getElementById('message').value = '';
        document.getElementById('key').value = 3;
        document.getElementById('output').innerText = 'Encrypted/Decrypted text will appear here...';
        document.getElementById('keyError').style.display = 'none';
    }
</script>
{% endblock %}